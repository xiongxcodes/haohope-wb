{"hidden":false,"children":[{"configs":{"itemId":"module","serverMethod":"com.wb.interact.Tools.loadKeyNames"},"expanded":true,"children":[{"configs":{"itemId":"win","focusControl":"FIELD_NAME","defaults":"{\n  layoutType: 'anchorForm'\n}","editWin":"true","width":"776","layoutType":"anchorForm"},"expanded":true,"children":[{"configs":{"itemId":"generalSet","title":"常规","collapsible":"true"},"expanded":false,"children":[{"configs":{"tagConfigs":"{\n  getValue: function() { //重载getValue使其取值大写\n    var val = Ext.form.field.ComboBox.prototype.getValue.apply(this);\n    return val ? val.toUpperCase() : val;\n  }\n}","itemId":"FIELD_NAME","allowBlank":"false","queryMode":"local","fieldLabel":"字段名称","displayField":"name","fieldStyle":"text-transform:uppercase;"},"expanded":false,"children":[{"configs":{"itemId":"store","fields":"['name']"},"expanded":false,"children":[],"type":"store"}],"type":"combo"},{"configs":{"itemId":"DISP_TEXT","fieldLabel":"显示标题"},"expanded":true,"children":[],"type":"text"},{"configs":{"itemId":"LINK_TO","fieldLabel":"链接"},"expanded":false,"children":[],"type":"text"}],"type":"fieldset"},{"configs":{"itemId":"displaySet","title":"显示","collapsible":"true"},"expanded":false,"children":[{"configs":{"itemId":"DISP_WIDTH","minValue":"-1","fieldLabel":"显示宽度"},"expanded":false,"children":[],"type":"number"},{"configs":{"itemId":"DISP_FORMAT","fieldLabel":"显示格式"},"expanded":false,"children":[],"type":"text"},{"configs":{"itemId":"ALIGN","fieldLabel":"对齐方式","displayField":"text","valueField":"value","forceSelection":"true"},"expanded":false,"children":[{"configs":{"itemId":"store","autoLoad":"true","url":"m?xwl=dev/datainfo/SQL/dict/align-list"},"expanded":false,"children":[],"type":"store"}],"type":"combo"},{"configs":{"itemId":"KEY_NAME","pickList":"Wb.decode(\"{#keyNameList#}\")","fieldLabel":"键名称","forceSelection":"true"},"expanded":false,"children":[],"type":"combo"},{"configs":{"itemId":"FIELD_SIZE","minValue":"-1","fieldLabel":"字段长度"},"expanded":false,"children":[],"type":"number"},{"configs":{"itemId":"DECIMAL_PRECISION","minValue":"-1","fieldLabel":"小数位数"},"expanded":false,"children":[],"type":"number"},{"configs":{"itemId":"ORDER_INDEX","minValue":"0","fieldLabel":"排序号"},"expanded":false,"children":[],"type":"number"}],"type":"fieldset"},{"configs":{"itemId":"optionSet","collapsed":"true","title":"可选项","collapsible":"true"},"expanded":false,"children":[{"configs":{"layout":"hbox","itemId":"container1","defaults":"{\n  flex: 1\n}"},"expanded":true,"children":[{"configs":{"itemId":"NO_LIST","boxLabel":"禁止显示","returnNumber":"true"},"expanded":false,"children":[],"type":"check"},{"configs":{"itemId":"NO_EDIT","boxLabel":"禁止编辑","returnNumber":"true"},"expanded":false,"children":[],"type":"check"},{"configs":{"itemId":"AUTO_WRAP","boxLabel":"自动换行","returnNumber":"true"},"expanded":false,"children":[],"type":"check"},{"configs":{"itemId":"NO_BLANK","boxLabel":"禁止为空","returnNumber":"true"},"expanded":false,"children":[],"type":"check"},{"configs":{"itemId":"READ_ONLY","boxLabel":"只读","returnNumber":"true"},"expanded":false,"children":[],"type":"check"}],"type":"container"}],"type":"fieldset"},{"configs":{"itemId":"additionSet","collapsed":"true","layoutType":"tableColumn2","title":"辅助","collapsible":"true"},"expanded":false,"children":[{"configs":{"itemId":"VALIDATOR","useMultiLine":"true","onTriggerClick":"app.setColEditor(this);","editable":"false","fieldLabel":"验证或控件","triggerCls":"x-form-ellipsis-trigger"},"expanded":false,"children":[],"type":"combo"},{"configs":{"itemId":"RENDERER","useMultiLine":"true","onTriggerClick":"app.setColConfig(this);","editable":"false","fieldLabel":"列配置","triggerCls":"x-form-ellipsis-trigger"},"expanded":false,"children":[],"type":"combo"}],"type":"fieldset"}],"type":"window","events":{"ok":"win.editHandler();"}},{"configs":{"itemId":"colConfigWin","editWin":"true","width":"700","layoutType":"anchorForm","iconCls":"column_icon","title":"列配置"},"expanded":false,"children":[{"configs":{"layout":"fit","itemId":"rendererSet","padding":"10","title":"列渲染","collapsible":"true","height":"260"},"expanded":true,"children":[{"configs":{"itemId":"colRenderer","file":"m?xwl=sys/tool/dev/script-editor"},"expanded":false,"children":[],"type":"xwl"}],"type":"fieldset"},{"configs":{"layout":"fit","itemId":"tagSet","padding":"10","title":"自定义配置项","collapsible":"true","height":"160"},"expanded":true,"children":[{"configs":{"itemId":"colTag","file":"m?xwl=sys/tool/dev/script-editor","params":"{\n  type: 'json'\n}"},"expanded":false,"children":[],"type":"xwl"}],"type":"fieldset"},{"configs":{"itemId":"querySet","padding":"0 10 10 10","layoutType":"anchorForm","title":"查询分析","collapsible":"true"},"expanded":true,"children":[{"configs":{"itemId":"fieldType","columns":"6","fieldLabel":"字段类别"},"expanded":true,"children":[{"configs":{"itemId":"radio1","boxLabel":"维度"},"expanded":false,"children":[],"type":"radio"},{"configs":{"itemId":"radio2","boxLabel":"度量"},"expanded":false,"children":[],"type":"radio"},{"configs":{"itemId":"radio3","boxLabel":"默认"},"expanded":false,"children":[],"type":"radio"}],"type":"radiogroup"},{"configs":{"itemId":"aggrType","fieldLabel":"聚合方法"},"expanded":true,"children":[{"configs":{"itemId":"radio1","boxLabel":"sum"},"expanded":false,"children":[],"type":"radio"},{"configs":{"itemId":"radio2","boxLabel":"avg"},"expanded":false,"children":[],"type":"radio"},{"configs":{"itemId":"radio3","boxLabel":"count"},"expanded":false,"children":[],"type":"radio"},{"configs":{"itemId":"radio4","boxLabel":"max"},"expanded":false,"children":[],"type":"radio"},{"configs":{"itemId":"radio5","boxLabel":"min"},"expanded":false,"children":[],"type":"radio"},{"configs":{"itemId":"radio6","boxLabel":"默认"},"expanded":false,"children":[],"type":"radio"}],"type":"radiogroup"}],"type":"fieldset"}],"type":"window","events":{"show":"app.colRenderer.focus();","ok":"var val, validFieldType, validAggrType, tag = app.colTag.getValue().trim(),\n  renderer = app.colRenderer.getValue().trim(),\n  fieldType = app.fieldType.getValue(),\n  aggrType = app.aggrType.getValue();\nif (tag) {\n  try {\n    val = Wb.decode(tag);\n  } catch (e) {\n    Wb.warn('自定义配置项无效。', function() {\n      app.colTag.focus();\n    });\n    return;\n  }\n} else val = {};\nvalidFieldType = !(fieldType == -1 || fieldType == 2);\nvalidAggrType = !(aggrType == -1 || aggrType == 5);\nif (!tag && !validFieldType && !validAggrType) {\n  val = renderer;\n} else {\n  if (renderer)\n    val.renderer = renderer;\n  val.olapItems = {};\n  if (validFieldType)\n    val.olapItems.fieldType = fieldType;\n  if (validAggrType)\n    val.olapItems.aggrType = aggrType;\n  if (Wb.isEmpty(val.olapItems))\n    delete val.olapItems;\n  val = Wb.encode(val);\n}\napp.RENDERER.setValue(val);\nwin.close();"}},{"configs":{"layout":"vbox","itemId":"editorConfigWin","defaults":"{\n  flex: 1\n}","editWin":"true","resizable":"true","width":"700","bodyPadding":"0 30 12 30","iconCls":"column_icon","title":"列配置","maximizable":"true"},"expanded":false,"children":[{"configs":{"layout":"fit","itemId":"validatorSet","padding":"10","title":"验证方法","collapsible":"true","height":"260"},"expanded":true,"children":[{"configs":{"itemId":"editorValidator","file":"m?xwl=sys/tool/dev/script-editor"},"expanded":false,"children":[],"type":"xwl"}],"type":"fieldset"},{"configs":{"layout":"fit","itemId":"editorSet","padding":"10","title":"控件配置项","collapsible":"true","height":"160"},"expanded":true,"children":[{"configs":{"itemId":"colEditor","file":"m?xwl=sys/tool/dev/script-editor","params":"{\n  type: 'json'\n}"},"expanded":false,"children":[],"type":"xwl"}],"type":"fieldset"}],"type":"window","events":{"show":"app.editorValidator.focus();","ok":"var val, editorValue = app.colEditor.getValue().trim(),\n  validator = app.editorValidator.getValue().trim();\nif (editorValue) {\n  try {\n    val = Wb.decode(editorValue);\n  } catch (e) {\n    Wb.warn('控件配置项无效。', function() {\n      app.colEditor.focus();\n    });\n    return;\n  }\n  if (validator)\n    val.validator = validator;\n  val = Wb.encode(val);\n} else val = validator;\napp.VALIDATOR.setValue(val);\nwin.close();"}},{"configs":{"itemId":"addTableWin","focusControl":"true","editWin":"true","width":"464","layoutType":"anchorForm","iconCls":"table_add_icon","title":"添加字典表"},"expanded":false,"children":[{"configs":{"itemId":"dictTableName","fieldLabel":"字典表名"},"expanded":false,"children":[],"type":"text"}],"type":"window","events":{"ok":"var tableName = app.dictTableName.getValue().toUpperCase();\nWb.request({\n  url: 'm?xwl=dev/datainfo/SQL/dict/insert-dict-table',\n  params: {\n    dictTableName: tableName\n  },\n  success: function(resp) {\n    var node = Wb.getNode(app.tableTree.getSelection()[0], 1);\n    Wb.loadSelect(node, {\n      iconCls: 'table_add_icon',\n      jndi: node.data.jndi,\n      type: 'table',\n      schema: '',\n      leaf: true,\n      text: tableName,\n      table: tableName\n    });\n    win.close();\n  }\n});"}},{"configs":{"layout":"border","itemId":"viewport1"},"expanded":true,"children":[{"configs":{"itemId":"tableTree","split":"true","plugins":"{\n  ptype: 'bufferedrenderer'\n}","width":"200","region":"west","title":"数据库列表","iconCls":"db_icon","collapsible":"true","rootVisible":"false"},"expanded":false,"children":[{"configs":{"itemId":"store","fields":"['text', 'jndi', 'type', 'schema', 'table']","url":"m?xwl=dev/datainfo/SQL/dict/get-tree"},"expanded":false,"children":[],"type":"treestore","events":{"beforeload":"operation.params = operation.node.data;"}},{"configs":{"itemId":"tools"},"expanded":true,"children":[{"configs":{"itemId":"refreshBtn","tooltip":"刷新","tooltype":"refresh"},"expanded":false,"children":[],"type":"item","events":{"click":"Wb.reload(app.tableTree);"}},{"configs":{"itemId":"setBtn","tooltip":"切换表名前Schem","tooltype":"gear"},"expanded":false,"children":[],"type":"item","events":{"click":"Ext.suspendLayouts();\napp.tableTree.getRootNode().cascadeBy(function(node) {\n  if (node.isLeaf()) {\n    node.set('text', node.data.table);\n    node.commit();\n  }\n});\nExt.resumeLayouts(true);"}}],"type":"array"}],"type":"tree","events":{"selectionchange":"var tableName, jndi, grid = app.grid1,\n  rec = selected[0];\nif (rec && rec.isLeaf()) {\n  if (grid.disabled)\n    grid.setDisabled(false);\n  jndi = rec.data.jndi;\n  tableName = (jndi == 'default' ? '' : (jndi + '.')) + rec.data.table; //表名不带schema，如果非默认数据库则带jndi变量名前缀\n  app.tableName = tableName.toUpperCase();\n  app.jndi = rec.data.jndi;\n  app.fullTableName = Wb.addPrefix(rec.data.schema, rec.data.table);\n  Wb.setTitle(grid, tableName);\n  app.gridStore.load();\n}","afterrender":"Wb.setNavigate(tree, app.backBtn, app.forwardBtn);"}},{"configs":{"itemId":"grid1","disabled":"true","region":"center","title":"字段字典定义","iconCls":"book_icon","multiSelect":"true"},"expanded":true,"children":[{"configs":{"itemId":"tbar","enableOverflow":"true","region":"north"},"expanded":false,"children":[{"configs":{"itemId":"newBtn","tooltip":"添加新的记录 (Ctrl+E)","text":"添加","iconCls":"record_add_icon"},"expanded":false,"children":[],"type":"item","events":{"click":"var win = Wb.insert(app.grid1, {\n  title: '添加 - ' + app.tableName,\n  win: app.win,\n  url: 'm?xwl=dev/datainfo/SQL/dict/insert',\n  params: {\n    TABLE_NAME: app.tableName\n  }\n});\napp.reloadFields(win);"}},{"configs":{"itemId":"editBtn","tooltip":"修改选择的记录","text":"修改","iconCls":"record_edit_icon"},"expanded":false,"children":[],"type":"item","events":{"click":"var win = Wb.edit(app.grid1, {\n  titleField: 'FIELD_NAME',\n  win: app.win,\n  url: 'm?xwl=dev/datainfo/SQL/dict/update',\n  params: {\n    TABLE_NAME: app.tableName\n  }\n});\napp.reloadFields(win);"}},{"configs":{"itemId":"delBtn","tooltip":"删除选择的记录","text":"删除","iconCls":"record_delete_icon"},"expanded":false,"children":[],"type":"item","events":{"click":"Wb.del(app.grid1, {\n  url: 'm?xwl=dev/datainfo/SQL/dict/delete',\n  titleField: 'FIELD_NAME'\n});"}},{"configs":{"itemId":"item1","text":"-"},"expanded":false,"children":[],"type":"item"},{"configs":{"itemId":"newTableBtn","tooltip":"添加新的字典表","text":"添加表","iconCls":"table_add_icon"},"expanded":false,"children":[],"type":"item","events":{"click":"app.addTableWin.show();"}},{"configs":{"itemId":"item4","text":"-"},"expanded":false,"children":[],"type":"item"},{"configs":{"itemId":"item3","xtype":"tbtext","text":"搜索："},"expanded":false,"children":[],"type":"item"},{"configs":{"itemId":"searchCombo","onTriggerClick":"app.search();","emptyText":"字段名称","triggerCls":"x-form-search-trigger","width":"230","displayField":"FIELD_NAME","enterKeyTriggerClick":"true","fieldStyle":"text-transform:uppercase;"},"expanded":true,"children":[{"configs":{"itemId":"store","url":"m?xwl=dev/datainfo/SQL/dict/search"},"expanded":false,"children":[],"type":"store","events":{"beforeload":"operation.params.TABLE_NAME = app.tableName;"}}],"type":"combo","events":{"beforequery":"plan.query = (plan.query || '').toUpperCase();","select":"app.search();"}},{"configs":{"itemId":"resetSearchBtn","tooltip":"重置搜索条件","iconCls":"undo_icon"},"expanded":false,"children":[],"type":"item","events":{"click":"app.search(true);"}},{"configs":{"itemId":"item2","text":"-"},"expanded":false,"children":[],"type":"item"},{"configs":{"itemId":"backBtn","tooltip":"转到上一个页面","text":"返回","iconCls":"left_icon"},"expanded":false,"children":[],"type":"item"},{"configs":{"itemId":"forwardBtn","tooltip":"转到后退前的页面","text":"前进","iconCls":"right_icon"},"expanded":false,"children":[],"type":"item"}],"type":"toolbar"},{"configs":{"itemId":"store","remoteSort":"true","normalName":"gridStore","sorters":"'ORDER_INDEX'","url":"m?xwl=dev/datainfo/SQL/dict/select"},"expanded":false,"children":[],"type":"store","events":{"success":"app.fieldNameList = Wb.getTag(app.grid1, 'tableFields');\nWb.each(app.fieldNameList, function(item) {\n  item.name = item.name.toUpperCase();\n});","beforeload":"Wb.apply(operation.params, {\n  jndi: app.jndi,\n  fullTableName: app.fullTableName,\n  TABLE_NAME: app.tableName\n});"}}],"type":"grid","events":{"itemdblclick":"app.editBtn.fireEvent('click');"}}],"type":"viewport","events":{"afterrender":"new Ext.KeyNav({\n  viewport: app.viewport1,\n  E: {\n    ctrl: true,\n    fn: function() {\n      if (!app.newBtn.disabled)\n        app.newBtn.fireEvent('click');\n    }\n  }\n});"}}],"type":"module","events":{"initialize":"Wb.apply(app, {\n  reloadFields: function() {\n    var items = [],\n      existFields = {};\n    app.gridStore.each(function(item) {\n      existFields[item.data.FIELD_NAME] = true;\n    });\n    Wb.each(app.fieldNameList, function(item) {\n      if (!existFields[item.name])\n        items.push(item);\n    });\n    app.FIELD_NAME.store.loadData(items);\n  },\n  search: function(reset) {\n    app.searchCombo.collapse();\n    app.gridStore.load(reset ? null : {\n      out: app.grid1.down('toolbar')\n    });\n  },\n  setColEditor: function(cb) {\n    var val = cb.getValue();\n    if (val.substring(0, 1) == '{') {\n      val = Wb.decode(val);\n    } else {\n      val = {\n        validator: val\n      };\n    }\n    app.editorConfigWin.show();\n    app.editorValidator.setValue(val.validator);\n    delete val.validator;\n    app.colEditor.setValue(Wb.isEmpty(val) ? '' : Wb.encode(val));\n    app.colEditor.editor.autoFormatRange({\n      line: 0,\n      ch: 0\n    }, {\n      line: Number.MAX_VALUE,\n      ch: Number.MAX_VALUE\n    });\n  },\n  setColConfig: function(cb) {\n    var val = cb.getValue();\n    if (val.substring(0, 1) == '{') {\n      val = Wb.decode(val);\n    } else {\n      val = {\n        renderer: val\n      };\n    }\n    app.colConfigWin.show();\n    app.colRenderer.setValue(val.renderer);\n    Wb.setValue(app.querySet, val.olapItems);\n    delete val.renderer;\n    delete val.olapItems;\n    app.colTag.setValue(Wb.isEmpty(val) ? '' : Wb.encode(val));\n    app.colTag.editor.autoFormatRange({\n      line: 0,\n      ch: 0\n    }, {\n      line: Number.MAX_VALUE,\n      ch: Number.MAX_VALUE\n    });\n  }\n});"}}],"roles":{},"title":"数据字典","iconCls":"f02d","inframe":false,"pageLink":""}