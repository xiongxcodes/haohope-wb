{"hidden":true,"children":[{"configs":{"itemId":"module"},"expanded":true,"children":[{"configs":{"layout":"hbox","itemId":"win","editWin":"true","resizable":"true","width":"1000","iconCls":"role_icon","maximizable":"true","height":"420"},"expanded":true,"children":[{"configs":{"layout":"fit","itemId":"panel1","flex":"1","title":"可选择角色"},"expanded":true,"children":[{"configs":{"isConfig":"true","itemId":"tbar"},"expanded":true,"children":[{"configs":{"itemId":"searchLabel","xtype":"tbtext","text":"搜索："},"expanded":false,"children":[],"type":"item"},{"configs":{"itemId":"searchText","flex":"1","emptyText":"用户或显示名称"},"expanded":false,"children":[],"type":"text","events":{"change":"app.sourceStore.load({\n  params: {\n    query: app.searchText.getValue()\n  }\n});"}},{"configs":{"itemId":"delBtn","glyph":"f00d","buttonStyle":"default","tooltip":"删除"},"expanded":false,"children":[],"type":"button","events":{"click":"Wb.reset(app.searchText);"}}],"type":"toolbar"},{"configs":{"itemId":"sourceGrid","viewConfig":"{\n  plugins: {\n    ptype: 'gridviewdragdrop'\n  },\n  listeners: {\n    beforedrop: function(node, data, dropRec, dropPosition) {\n      return data.view != app.sourceGrid.view;\n    },\n    drop: function() {\n      Wb.refreshRowNum(app.sourceGrid);\n    }\n  }\n}","multiSelect":"true"},"expanded":true,"children":[{"configs":{"itemId":"store","normalName":"sourceStore","url":"m?xwl=sys/app/role/select-role"},"expanded":false,"children":[],"type":"store","events":{"success":"var map, roleId, roleName, notHasId, recs = [];\nif (app.checkByRoleId) {\n  roleId = app.roleId;\n  roleName = app.roleName;\n  app.checkByRoleId = false;\n} else {\n  roleId = Wb.pluck(app.destStore.getRange(), 'ROLE_ID');\n  roleName = Wb.pluck(app.destStore.getRange(), 'ROLE_NAME');\n}\nnotHasId = Wb.isEmpty(roleId);\nif (notHasId && Wb.isEmpty(roleName))\n  return;\nif (notHasId)\n  map = Wb.toObject(roleName);\nelse\n  map = Wb.toObject(roleId);\napp.sourceStore.each(function(rec) {\n  if (notHasId) {\n    if (map[rec.data.ROLE_NAME])\n      recs.push(rec);\n  } else {\n    if (map[rec.data.ROLE_ID])\n      recs.push(rec);\n  }\n});\napp.sourceStore.remove(recs);"}},{"configs":{"itemId":"columns"},"expanded":true,"children":[{"configs":{"itemId":"rowNumCol","xtype":"rownumberer"},"expanded":false,"children":[],"type":"column"},{"configs":{"itemId":"roleIdCol","dataIndex":"ROLE_ID","width":"150","text":"角色ID"},"expanded":false,"children":[],"type":"column"},{"configs":{"itemId":"roleNameCol","dataIndex":"ROLE_NAME","flex":"1","text":"角色名称"},"expanded":false,"children":[],"type":"column"}],"type":"array"}],"type":"grid","events":{"itemdblclick":"app.swap(app.sourceGrid, app.destGrid);"}}],"type":"panel"},{"configs":{"itemId":"container1","defaults":"{\n  margin: '0 0 10 0',\n  width: 30\n}","width":"40","layoutType":"vboxPackCenter"},"expanded":true,"children":[{"configs":{"itemId":"inclBtn","buttonStyle":"default","text":">"},"expanded":false,"children":[],"type":"button","events":{"click":"app.swap(app.sourceGrid, app.destGrid);"}},{"configs":{"itemId":"inclAllBtn","buttonStyle":"default","text":">>"},"expanded":false,"children":[],"type":"button","events":{"click":"app.swap(app.sourceGrid, app.destGrid, true);"}},{"configs":{"itemId":"exclBtn","buttonStyle":"default","text":"<"},"expanded":false,"children":[],"type":"button","events":{"click":"app.swap(app.destGrid, app.sourceGrid);"}},{"configs":{"itemId":"exclAllBtn","buttonStyle":"default","text":"<<"},"expanded":false,"children":[],"type":"button","events":{"click":"app.swap(app.destGrid, app.sourceGrid, true);"}}],"type":"container"},{"configs":{"itemId":"destGrid","flex":"1","pagingBar":"false","viewConfig":"{\n  plugins: {\n    ptype: 'gridviewdragdrop'\n  },\n  listeners: {\n    drop: function() {\n      Wb.refreshRowNum(app.destGrid);\n    }\n  }\n}","title":"已选择角色","multiSelect":"true"},"expanded":true,"children":[{"configs":{"itemId":"store","normalName":"destStore","pageSize":"-1","url":"m?xwl=sys/app/role/select-specific-roles"},"expanded":false,"children":[],"type":"store"},{"configs":{"itemId":"columns"},"expanded":true,"children":[{"configs":{"itemId":"rowNumCol","xtype":"rownumberer"},"expanded":false,"children":[],"type":"column"},{"configs":{"itemId":"roleIdCol","dataIndex":"ROLE_ID","width":"150","text":"角色ID"},"expanded":false,"children":[],"type":"column"},{"configs":{"itemId":"roleNameCol","dataIndex":"ROLE_NAME","flex":"1","text":"角色名称"},"expanded":false,"children":[],"type":"column"}],"type":"array"}],"type":"grid","events":{"itemdblclick":"app.swap(app.destGrid, app.sourceGrid);"}}],"type":"window","events":{"hide":"app.sourceStore.removeAll();\napp.destStore.removeAll();","ok":"var recs = app.destStore.getRange(),\n  roleId = Wb.pluck(recs, 'ROLE_ID'),\n  roleName = Wb.pluck(recs, 'ROLE_NAME');\nExt.callback(app.callback, app, [roleId, roleName, win]);"}}],"type":"module","events":{"initialize":"Wb.apply(app, {\n  /**\n   * 显示角色选择对话框。\n   * @param {Function} callback 点击确定按钮后的回调函数。\n   * @param {String[]} callback.roleId 角色id列表。\n   * @param {String[]} callback.roleName 角色名称列表。\n   * @param {Ext.window.Window} callback.win 窗口对象。\n   * @param {Object} [params] 可选参数。\n   * @param {String} [params.title] 窗口标题。\n   * @param {String[]} [params.roleId] 已经选择的角色id列表，roleId和roleName之间任选一项。\n   * @param {String[]} [params.roleName] 已经选择的角色名称列表，roleId和roleName之间任选一项。\n   */\n  show: function(callback, params) {\n    if (!params)\n      params = {};\n    app.callback = callback;\n    app.win.show();\n    app.win.setTitle(params.title || '角色选择');\n    app.checkByRoleId = true;\n    app.roleId = params.roleId;\n    app.roleName = params.roleName;\n    app.sourceStore.load();\n    if (!Wb.isEmpty(params.roleId) || !Wb.isEmpty(params.roleName)) {\n      app.destStore.load({\n        params: {\n          roleId: params.roleId,\n          roleName: params.roleName\n        }\n      });\n    }\n  },\n  //交换源表格和目标表格中的数据\n  swap: function(src, dst, isAll) {\n    var sels;\n    if (isAll) {\n      sels = src.store.getRange();\n      src.store.remove(sels);\n    } else {\n      sels = src.getSelection();\n      Wb.remove(src);\n    }\n    dst.store.add(sels);\n    dst.setSelection(sels);\n  }\n});"}}],"roles":{},"title":"角色选择","iconCls":"","inframe":false,"pageLink":""}