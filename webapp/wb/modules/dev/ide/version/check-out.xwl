{"hidden":true,"children":[{"configs":{"itemId":"module","serverScript":"var conn, st, emptyStream = SysUtil.getEmptyStream(),\n  files = app.getObject('files');\ntry {\n  conn = DbUtil.getConnection();\n  st = conn.prepareStatement('insert into WB_VERSION values (?,?,?,?,?,?,?,?)');\n  st.setTimestamp(2, DateUtil.now()); //CHECK_DATE\n  st.setString(5, app.get('sys.user')); //USER_ID\n  st.setString(6, app.get('version')); //VERSION\n  st.setString(7, app.get('versionDesc')); //VERSION_DESC\n  Wb.each(files, function(file) {\n    importFile(new File(file));\n  });\n} finally {\n  DbUtil.close(st);\n  DbUtil.close(conn);\n}\n\nfunction importFile(file) {\n  var is, isDir;\n  isDir = file.isDirectory();\n  if (isDir) {\n    Wb.each(file.listFiles(), function(sub) {\n      importFile(sub);\n    });\n    is = emptyStream;\n  } else {\n    is = new java.io.FileInputStream(file);\n  }\n  try {\n    st.setString(1, SysUtil.getId()); //S_ID\n    st.setTimestamp(3, new java.sql.Timestamp(file.lastModified())); //FILE_DATE\n    st.setString(4, FileUtil.getRelativePath(Base.path, file) + (isDir ? '/' : '')); //FILE_PATH\n    st.setBinaryStream(8, is, is.available()); //FILE_BLOB\n    st.executeUpdate();\n  } finally {\n    is.close();\n  }\n}"},"expanded":false,"children":[],"type":"module"}],"roles":{},"title":"检出","iconCls":"","inframe":false,"pageLink":""}