{"hidden":false,"children":[{"configs":{"serverScript":"//获取指定的根目录\nvar sysFolderBase = String(Var.getString(\"sys.ide.sysFolderBase\"));\nswitch (sysFolderBase) {\n  case 'app':\n    sysFolderBase = FileUtil.getPath(Base.path);\n    break;\n  case 'server':\n    sysFolderBase = FileUtil.getPath(Base.path.getParentFile()\n      .getParent()) + '/';\n    break;\n  default:\n    sysFolderBase = '';\n}\nrequest.setAttribute('sysFolderBase', sysFolderBase);","itemId":"module"},"expanded":true,"children":[{"configs":{"itemId":"menu","menu":" [{\n   text: '新建文件',\n   glyph: 'f016',\n   handler: app.addFile\n }, {\n   text: '新建文件夹',\n   glyph: 'f114',\n   handler: app.addFolder\n }, {\n   text: '重命名',\n   glyph: 'f044',\n   handler: app.rename\n }, {\n   text: '剪切',\n   glyph: 'f0c4',\n   handler: app.cut\n }, {\n   text: '复制',\n   glyph: 'f0c5',\n   handler: app.copy\n }, {\n   text: '粘贴',\n   glyph: 'f0ea',\n   handler: app.paste\n }, {\n   text: '删除',\n   glyph: 'f00d',\n   handler: app.remove\n }, {\n   text: '导出',\n   glyph: 'f0aa',\n   handler: app.exportFiles\n }, {\n   text: '导入',\n   glyph: 'f0ab',\n   handler: app.importFiles\n }, {\n   text: '属性',\n   glyph: 'f05a',\n   handler: app.viewProperties\n }, {\n   text: '刷新',\n   glyph: 'f021',\n   handler: app.refresh\n }]"},"expanded":false,"children":[],"type":"tpanel"},{"configs":{"layout":"fit","itemId":"viewport1","appImage":"wb/images/icon/explorer.png"},"expanded":true,"children":[{"configs":{"layout":"fit","itemId":"container1"},"expanded":true,"children":[{"configs":{"itemId":"fileList","title":"Root"},"expanded":true,"children":[{"configs":{"itemId":"toolbar","ui":"light","docked":"top"},"expanded":true,"children":[{"configs":{"itemId":"checkBtn","glyph":"f096","align":"right"},"expanded":false,"children":[],"type":"tbutton","events":{"tap":"app.checkStatus = !app.checkStatus;\napp.checkBtn.setGlyph(app.checkStatus ? 0xf046 : 0xf096);\napp.fileList.setFolderSelect(app.checkStatus);\napp.fileList._activeItem.deselectAll();\napp.fileList._activeItem.setMode(app.checkStatus ? 'MULTI' : 'SINGLE');"}},{"configs":{"itemId":"menuBtn","glyph":"f0c9","align":"right"},"expanded":false,"children":[],"type":"tbutton","events":{"tap":"app.menu.showBy(button);"}}],"type":"ttitlebar"},{"configs":{"itemId":"store","normalName":"fileStore","fields":"['text', 'icon', 'size', 'leaf', 'date', 'type']","url":"m?xwl=sys/tool/file/get-files&mode=1"},"expanded":false,"children":[],"type":"ttreestore","events":{"beforeload":"var path, node = operation._node;\nif (node.isRoot())\n  path = app.basePath;\nelse\n  path = app.getPath(node);\nExt.applyIf(operation._params, {\n  path: path\n});"}},{"configs":{"itemId":"listConfig","itemTpl":"<span><img src='{icon}' class='wb_icon2'>{text}<\/span>"},"expanded":false,"children":[],"type":"tlist"}],"type":"tnlist","events":{"listchange":"listitem.setMode(app.checkStatus ? 'MULTI' : 'SINGLE');"}}],"type":"tcontainer"}],"type":"tviewport"}],"type":"module","events":{"initialize":"Wb.apply(app, {\n  /** 根路径 */\n  basePath: '{#sysFolderBase#}',\n  /**\n   * 获取文件列表中文件节点的绝对路径。\n   * @param {NodeInterface} node 节点对象。\n   * @return {String} 绝对路径。\n   */\n  getPath: function(node) {\n    if (!node || node.isRoot()) return '';\n    var path = Wb.getSection(node.getPath('text'), '/', 2);\n    path = app.basePath ? (app.basePath + '/' + path) : path;\n    return path.replace('//', '/');\n  },\n  /** 获得当前路径 */\n  getCurrentPath: function() {\n    return app.getPath(app.fileList._lastNode);\n  },\n  /** 获取选择的文件/目录列表 */\n  getFileNames: function() {\n    var rows, fileNames, path = app.getCurrentPath();\n    if (!Ext.String.endsWith(path, '/'))\n      path += '/';\n    rows = app.fileList._activeItem.getSelection();\n    fileNames = [];\n    Wb.each(rows, function(row) {\n      fileNames.push(path + row.data.text);\n    });\n    return fileNames;\n  },\n  /** 转到指定节点 */\n  goto: function() {\n    var node = this.initialConfig.node;\n    app.fileList.goToNode(node);\n  },\n  /** 添加文件 */\n  addFile: function() {\n    app.doAddFile(false);\n  },\n  /** 添加目录 */\n  addFolder: function() {\n    app.doAddFile(true);\n  },\n  /** 执行复制或剪切方法 */\n  doCopy: function(isCut) {\n    app.isCut = isCut;\n    if (isCut) {\n      app.cutFromStore = app.fileList._activeItem.store;\n      app.cutItems = app.fileList._activeItem.getSelection();\n    }\n    app.clipboard = app.getFileNames();\n  },\n  /** 复制操作 */\n  copy: function() {\n    app.doCopy(false);\n  },\n  /** 剪切操作 */\n  cut: function() {\n    app.doCopy(true);\n  },\n  /** 粘贴操作 */\n  paste: function() {\n    if (!app.clipboard || !app.clipboard.length) {\n      Wb.warn('没有可以粘贴的文件/目录。');\n      return;\n    }\n    Wb.request({\n      url: 'm?xwl=sys/tool/file/paste',\n      timeout: -1,\n      params: {\n        isCut: app.isCut,\n        src: app.clipboard,\n        dst: app.getCurrentPath()\n      },\n      success: function(resp) {\n        if (app.isCut) {\n          app.clipboard = null;\n          app.cutFromStore.remove(app.cutItems);\n        }\n        app.refresh();\n      }\n    });\n  },\n  /** 删除操作 */\n  remove: function() {\n    var list = app.fileList._activeItem,\n      items = list.getSelection();\n    Wb.confirmDo(items, function() {\n      Wb.request({\n        url: 'm?xwl=sys/tool/file/delete',\n        params: {\n          fileGrid: Wb.getData(items),\n          path: app.getCurrentPath()\n        },\n        success: function(resp) {\n          Wb.remove(list);\n        }\n      });\n    }, 'text');\n  },\n  /** 刷新操作 */\n  refresh: function() {\n    app.fileStore.load({\n      node: app.fileList._lastNode\n    });\n  },\n  /** 导入文件 */\n  importFiles: function() {\n    Wb.prompt({\n      title: '导入 - ' + app.fileList._lastNode.data.text,\n      items: [{\n        label: '文件',\n        xtype: 'filefield',\n        required: true,\n        itemId: 'file'\n      }, {\n        label: '解压',\n        xtype: 'togglefield',\n        required: true,\n        itemId: 'unzip'\n      }],\n      handler: function(values, panel) {\n        var name = Wb.getValue(panel, null, true).file;\n        if (values.unzip && !Ext.String.endsWith(name.toLowerCase(), '.zip')) {\n          Wb.warn('请选择一个 zip 格式的文件。');\n          return false;\n        }\n        Wb.upload({\n          form: panel,\n          url: 'upload',\n          params: {\n            path: app.getCurrentPath()\n          },\n          success: function() {\n            panel.destroy();\n            app.refresh();\n          }\n        });\n      }\n    });\n  },\n  /** 导出文件或目录 */\n  exportFiles: function() {\n    var files = app.getFileNames(null, true);\n    if (!files.length) {\n      Wb.warn('请选择至少一个需要导出的文件或目录。');\n      return;\n    }\n    Wb.download('download', {\n      files: files\n    });\n  },\n  /** 文件/目录重命名操作 */\n  rename: function() {\n    var path = app.getCurrentPath(),\n      selItem = app.fileList._activeItem.getSelection()[0];\n    if (!selItem) {\n      Wb.warn('请选择一个文件/文件夹。');\n      return;\n    }\n    oldName = selItem.data.text;\n    Wb.prompt({\n      title: '重命名 - ' + oldName,\n      items: [{\n        label: '新名称',\n        required: true,\n        itemId: 'name',\n        value: oldName\n      }],\n      handler: function(values, panel) {\n        Wb.request({\n          url: 'm?xwl=sys/tool/file/rename',\n          params: {\n            path: app.getCurrentPath(),\n            oldName: oldName,\n            newName: values.name\n          },\n          success: function(resp) {\n            var obj = Wb.decode(resp.responseText);\n            panel.destroy();\n            Wb.update(selItem, {\n              text: values.name,\n              icon: 'm?xwl=dev/ide/get-file-icon&file=' + obj.icon\n            });\n          }\n        });\n      }\n    });\n  },\n  /** 执行添加文件或目录方法 */\n  doAddFile: function(isDir) {\n    var path = app.getCurrentPath();\n    if (!path) {\n      Wb.warn('请选择一个文件夹。');\n      return;\n    }\n    Wb.prompt({\n      title: isDir ? '新建文件夹' : '新建文件',\n      items: [{\n        label: isDir ? '文件夹名称' : '文件名称',\n        required: true,\n        itemId: 'name'\n      }],\n      handler: function(values, panel) {\n        Wb.request({\n          url: 'm?xwl=sys/tool/file/add-file',\n          params: {\n            path: app.getCurrentPath(),\n            name: values.name,\n            isDir: isDir\n          },\n          success: function(resp) {\n            panel.destroy();\n            app.refresh();\n          }\n        });\n      }\n    });\n  },\n  /** 显示文件属性 */\n  viewProperties: function() {\n    var file, sels = app.fileList._activeItem.getSelection();\n    if (sels.length == 1) {\n      file = sels[0];\n      Wb.prompt({\n        title: '属性',\n        items: [{\n          label: '文件名称',\n          readOnly: true,\n          value: file.data.text\n        }, {\n          label: '路径',\n          readOnly: true,\n          value: app.getCurrentPath()\n        }, {\n          label: '类型',\n          readOnly: true,\n          value: file.data.type\n        }, {\n          label: '大小',\n          readOnly: true,\n          value: file.data.leaf ? (Wb.getFileSize(file.data.size) + ' (' + Wb.format(file.data.size, '#,###') + ' B)') : ''\n        }, {\n          label: '修改时间',\n          readOnly: true,\n          value: Wb.dateToText(file.data.date)\n        }]\n      });\n    } else\n      Wb.warn('请选择一个文件/文件夹。');\n  }\n});"}}],"roles":{},"title":"文件管理器","iconCls":"explorer_icon","inframe":true,"pageLink":""}