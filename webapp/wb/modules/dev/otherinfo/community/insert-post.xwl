{"hidden":true,"children":[{"configs":{"itemId":"module","serverScript":"if (Var.get('sys.app.versionType') == 'd' && app.get('sys.user') == 'test')\n  throw '不能使用该用户回复主题，请注册一个新用户。';\nvar rec, userRec,\n  totalRec = app.getRecord('select count(*) as \"CT\" from WB_BBS_POST where TITLE_ID={?TITLE_ID?}');\n//totalRec用户获取回复数量\nrec = {\n  POST_ID: app.get('sys.id'),\n  POST_DATE: new JavaDate(),\n  POST_USER: app.get('sys.user')\n};\napp.set(rec);\n//app.update默认启用事务\napp.update({\n  tableName: 'WB_BBS_POST',\n  mode: 'insert'\n});\napp.run('update WB_BBS_TITLE set REPLY_USER={?sys.user?},MODIFY_DATE={?POST_DATE?},REPLY_COUNT=REPLY_COUNT+1 where TITLE_ID={?TITLE_ID?}');\nuserRec = app.getRecord('select * from WB_USER where USER_ID={?sys.user?}');\napp.send(app.getPostHtml(rec.POST_ID, rec.POST_DATE, '#' + Integer.toString((++totalRec.CT)), userRec.DISPLAY_NAME,\n  userRec.USER_NAME, userRec.CREATE_DATE, userRec.LOGIN_TIMES, app.get('CONTENT'), true));","importModules":"[\"m?xwl=dev/otherinfo/community/common-util\",\"m?xwl=dev/otherinfo/community/limit-content-len\"]"},"expanded":true,"children":[],"type":"module"}],"roles":{},"title":"新建回复","iconCls":"","inframe":false,"pageLink":""}