{"hidden":true,"children":[{"configs":{"itemId":"module","serverScript":"var overPerm = app.getBool('overPerm'),\n  filePath = app.get('FILE_PATH'),\n  overFolderConfig = app.getBool('overFolderConfig'),\n  rs, sql, file, fileName, isDir, parentFile, content, blobStream, byteStream, srcJson, dstJson;\n\nif (filePath.endsWith('/')) {\n  //目录\n  if (filePath == '/')\n    app.set('FILE_PATH', '%');\n  else\n    app.set('FILE_PATH', filePath + '%');\n  sql = 'select FILE_PATH,FILE_BLOB from WB_VERSION where CHECK_DATE={?timestamp.CHECK_DATE?} and VERSION={?VERSION?} and FILE_PATH like {?FILE_PATH?}';\n} else {\n  //文件\n  sql = 'select FILE_PATH,FILE_BLOB from WB_VERSION where CHECK_DATE={?timestamp.CHECK_DATE?} and VERSION={?VERSION?} and FILE_PATH={?FILE_PATH?}';\n}\nrs = app.run(sql);\nwhile (rs.next()) {\n  fileName = rs.getString(1);\n  isDir = fileName.endsWith('/');\n  if (isDir)\n    fileName = fileName.substring(0, fileName.length() - 1);\n  file = new File(Base.path, fileName);\n  if (isDir) {\n    if (!file.exists())\n      file.mkdirs();\n  } else {\n    byteStream = new java.io.ByteArrayOutputStream();\n    blobStream = rs.getBinaryStream(2);\n    try {\n      IOUtils.copy(blobStream, byteStream);\n    } finally {\n      blobStream.close();\n    }\n    parentFile = file.getParentFile();\n    if (!parentFile.exists())\n      parentFile.mkdirs();\n    if (fileName.endsWith('.xwl') && !overPerm && file.exists()) {\n      content = new JavaString(byteStream.toByteArray(), 'utf-8');\n      srcJson = Wb.decode(content);\n      dstJson = Wb.readJson(file);\n      srcJson.roles = dstJson.roles;\n      FileUtil.syncSave(file, Wb.encode(srcJson));\n    } else {\n      if (overFolderConfig || FileUtil.getFilename(fileName) != 'folder.json')\n        FileUtil.syncSave(file, byteStream.toByteArray());\n    }\n  }\n}"},"expanded":false,"children":[],"type":"module"}],"roles":{},"title":"检入","iconCls":"","inframe":false,"pageLink":""}