{"hidden":false,"children":[{"configs":{"itemId":"module"},"expanded":true,"children":[{"configs":{"layout":"border","border":"false","itemId":"viewport1"},"expanded":true,"children":[{"configs":{"itemId":"toolbar1","region":"north"},"expanded":true,"children":[{"configs":{"itemId":"toggleBtn","tooltip":"显示/隐藏地图工具条","text":"切换工具条","iconCls":"tool_icon","enableToggle":"true"},"expanded":false,"children":[],"type":"item","events":{"toggle":"if (!app.mapToolCreated) {\n  app.topLeftControl = new BMap.ScaleControl({\n    anchor: BMAP_ANCHOR_TOP_LEFT\n  }); // 左上角，添加比例尺\n  app.topLeftNav = new BMap.NavigationControl(); //左上角，添加默认缩放平移控件\n  app.mapToolCreated = true;\n}\nif (pressed) {\n  app.map.addControl(app.topLeftControl);\n  app.map.addControl(app.topLeftNav);\n} else {\n  app.map.removeControl(app.topLeftControl);\n  app.map.removeControl(app.topLeftNav);\n}"}},{"configs":{"itemId":"addLabelBtn","tooltip":"在点击地图位置添加标签","text":"添加标签","iconCls":"label_icon","enableToggle":"true"},"expanded":false,"children":[],"type":"item","events":{"toggle":"app.clickHandler = pressed ? app.addLabel : null;"}},{"configs":{"itemId":"addMarkerBtn","tooltip":"在点击地图位置添加标记","text":"添加标记","iconCls":"record_edit_icon","enableToggle":"true"},"expanded":false,"children":[],"type":"item","events":{"toggle":"app.clickHandler = pressed ? app.addMarker : null;"}},{"configs":{"itemId":"searchBtn","tooltip":"按关键字搜索地名","text":"搜索关键字","iconCls":"search_icon"},"expanded":false,"children":[],"type":"item","events":{"click":"Wb.prompt({\n  title: '搜索',\n  iconCls: 'search_icon',\n  items: [{\n    fieldLabel: '关键字',\n    allowBlank: false,\n    value: '景点',\n    itemId: 'searchName'\n  }],\n  handler: function(values, win) {\n    app.map.clearOverlays();\n    var local = new BMap.LocalSearch(app.map, {\n      renderOptions: {\n        map: app.map\n      }\n    });\n    local.search(values.searchName);\n    win.close();\n  }\n});"}},{"configs":{"itemId":"routeBtn","tooltip":"查询两地之间的驾车路线","text":"路线查询","iconCls":"set_icon"},"expanded":false,"children":[],"type":"item","events":{"click":"Wb.prompt({\n  title: '路线查询',\n  iconCls: 'set_icon',\n  items: [{\n    fieldLabel: '起点',\n    allowBlank: false,\n    value: '北京站',\n    itemId: 'from'\n  }, {\n    fieldLabel: '终点',\n    allowBlank: false,\n    value: '清华大学',\n    itemId: 'to'\n  }, {\n    fieldLabel: '驾车策略',\n    xtype: 'combo',\n    allowBlank: false,\n    store: [\n      [0, '最少时间'],\n      [1, '最短距离'],\n      [2, '避开高速']\n    ],\n    value: 0,\n    itemId: 'policy'\n  }],\n  handler: function(values, win) {\n    //三种驾车策略：最少时间，最短距离，避开高速\n    app.map.clearOverlays();\n    var routePolicy = [BMAP_DRIVING_POLICY_LEAST_TIME, BMAP_DRIVING_POLICY_LEAST_DISTANCE, BMAP_DRIVING_POLICY_AVOID_HIGHWAYS],\n      driving = new BMap.DrivingRoute(app.map, {\n        renderOptions: {\n          map: app.map,\n          autoViewport: true\n        },\n        policy: routePolicy[values.policy]\n      });\n    driving.search(values.from, values.to);\n    win.close();\n  }\n});"}},{"configs":{"itemId":"clearBtn","tooltip":"清除所有标记","text":"清除标记","iconCls":"db_field_delete_icon"},"expanded":false,"children":[],"type":"item","events":{"click":"app.map.clearOverlays();"}}],"type":"toolbar"},{"configs":{"itemId":"panel1","flat":"true","region":"center"},"expanded":true,"children":[],"type":"panel"}],"type":"viewport","events":{"afterrender":"function showMap() {\n  if (!window.BMap) {\n    Wb.warn('加载百度地图JS失败，请检查viewport1.afterrender事件中引用的百度地图JS地址是否正确。');\n    return;\n  }\n  var map = app.map = new BMap.Map(app.panel1.body.dom); // 创建Map实例\n  map.centerAndZoom(new BMap.Point(116.404, 39.915), 11); // 初始化地图,设置中心点坐标和地图级别\n  map.addControl(new BMap.MapTypeControl()); //添加地图类型控件\n  map.setCurrentCity(\"北京\"); // 设置地图显示的城市 此项是必须设置的\n  map.enableScrollWheelZoom(true); //开启鼠标滚轮缩放\n  map.addEventListener('click', function(e) {\n    if (app.clickHandler)\n      app.clickHandler(e.point.lng, e.point.lat);\n  });\n}\n\n//如果已经加载地图直接显示\nif (window.BMap)\n  Ext.defer(showMap, 50); //延时加载\nelse {\n  //否则先加载地图类库\n  app.baiduMapCallback = 'baiduMap' + Wb.getId();\n  Wb[app.baiduMapCallback] = showMap; //提供全局回调函数句柄给百度url，该句柄在viewport1的destroy事件中删除\n  Wb.addLink([{\n    //百度地图JS采用了重定向，因此回调在url中添加\n    url: 'http://api.map.baidu.com/api?v=2.0&ak=95ad44a29b40029310097884cc23f51b&callback=Wb.' + app.baiduMapCallback,\n    type: 'js'\n  }]);\n}","destroy":"if (app.baiduMapCallback)\n  delete Wb[app.baiduMapCallback];"}}],"type":"module","events":{"initialize":"Wb.apply(app, {\n  addLabel: function(lng, lat) {\n    app.addLabelBtn.toggle(false);\n    Wb.prompt({\n      title: '添加标签',\n      items: [{\n        fieldLabel: '标签',\n        allowBlank: false,\n        itemId: 'label'\n      }],\n      handler: function(values, win) {\n        var point = new BMap.Point(lng, lat);\n        //app.map.centerAndZoom(point, 15);\n        var opts = {\n          position: point // 指定文本标注所在的地理位置\n            //  offset: new BMap.Size(30, -30) //设置文本偏移量\n        };\n        var label = new BMap.Label(values.label, opts); // 创建文本标注对象\n        label.setStyle({\n          color: \"red\",\n          fontSize: \"12px\",\n          height: \"20px\",\n          lineHeight: \"20px\",\n          fontFamily: \"微软雅黑\"\n        });\n        app.map.addOverlay(label);\n        win.close();\n      }\n    });\n  },\n  showMarkerInfo: function() {\n    var p = this.getPosition(); //获取marker的位置\n    Wb.info(\"标记经度：\" + p.lng + \"，纬度：\" + p.lat);\n  },\n  addMarker: function(lng, lat) {\n    app.addMarkerBtn.toggle(false);\n    var point = new BMap.Point(lng, lat);\n    // map.centerAndZoom(point, 12);\n    var marker = new BMap.Marker(point); // 创建标注\n    app.map.addOverlay(marker); // 将标注添加到地图中\n    marker.addEventListener(\"click\", app.showMarkerInfo);\n  }\n});"}}],"roles":{},"title":"百度地图","iconCls":"","inframe":false,"pageLink":""}