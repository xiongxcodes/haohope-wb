{"hidden":false,"children":[{"configs":{"itemId":"module","serverScript":"app.set({\n  basePath: FileUtil.getPath(new File(Base.path, 'wb/system/resource')),\n  rootConfig: Wb.encode({\n    text: '全部'\n  }),\n  getFolderTreeUrl: 'm?xwl=my/rm/get-files&type=1',\n  getFilesUrl: 'm?xwl=my/rm/get-files&type=2',\n  addFileUrl: 'm?xwl=my/rm/add-file',\n  renameUrl: 'm?xwl=my/rm/rename',\n  deleteUrl: 'm?xwl=my/rm/delete',\n  pasteUrl: 'm?xwl=my/rm/paste',\n  getFileIconUrl: 'm?xwl=my/rm/get-file-icon',\n  downloadUrl: 'm?xwl=my/rm/download',\n  uploadUrl: 'm?xwl=my/rm/upload',\n  showPermBtn: app.perm('m?xwl=my/rm/get-perm')\n});","jsLinks":"[\"wb/script/flow{#debugSuffix#}.js\"]"},"expanded":true,"children":[{"configs":{"itemId":"permWin","defaults":"{\n  margin: 8,\n  padding: 8,\n  layout: {\n    type: 'vbox'\n  },\n  defaults: {\n    margin: 4\n  }\n}","editWin":"true","width":"700","layoutType":"anchorForm","iconCls":"option_icon","title":"访问权限设置"},"expanded":true,"children":[{"configs":{"itemId":"getFs","title":"查询："},"expanded":true,"children":[{"configs":{"layout":"hbox","itemId":"roleContainer"},"expanded":true,"children":[{"configs":{"fieldCls":"wb-disabled x-form-field","itemId":"getRoleCombo","margin":"0 5 0 0","onTriggerClick":"app.promptRoles('get');","editable":"false","flex":"1","triggerCls":"x-form-ellipsis-trigger","fieldLabel":"角色","labelWidth":"50"},"expanded":false,"children":[],"type":"combo"},{"configs":{"itemId":"delBtn","glyph":"f00d","buttonStyle":"default","tooltip":"重置"},"expanded":false,"children":[],"type":"button","events":{"click":"app.getRoleCombo.reset();\ndelete app.perms.get;"}}],"type":"container"},{"configs":{"layout":"hbox","itemId":"userContainer"},"expanded":true,"children":[{"configs":{"fieldCls":"wb-disabled x-form-field","itemId":"getUserCombo","margin":"0 5 0 0","onTriggerClick":"app.promptUsers('get');","editable":"false","flex":"1","triggerCls":"x-form-ellipsis-trigger","fieldLabel":"用户","labelWidth":"50"},"expanded":false,"children":[],"type":"combo"},{"configs":{"itemId":"delBtn","glyph":"f00d","buttonStyle":"default","tooltip":"重置"},"expanded":false,"children":[],"type":"button","events":{"click":"app.getUserCombo.reset();\ndelete app.perms.getUser;"}}],"type":"container"}],"type":"fieldset"},{"configs":{"itemId":"readFs","title":"读取："},"expanded":true,"children":[{"configs":{"layout":"hbox","itemId":"roleContainer"},"expanded":true,"children":[{"configs":{"fieldCls":"wb-disabled x-form-field","itemId":"readRoleCombo","margin":"0 5 0 0","onTriggerClick":"app.promptRoles('read');","editable":"false","flex":"1","triggerCls":"x-form-ellipsis-trigger","fieldLabel":"角色","labelWidth":"50"},"expanded":false,"children":[],"type":"combo"},{"configs":{"itemId":"delBtn","glyph":"f00d","buttonStyle":"default","tooltip":"重置"},"expanded":false,"children":[],"type":"button","events":{"click":"app.readRoleCombo.reset();\ndelete app.perms.read;"}}],"type":"container"},{"configs":{"layout":"hbox","itemId":"userContainer"},"expanded":true,"children":[{"configs":{"fieldCls":"wb-disabled x-form-field","itemId":"readUserCombo","margin":"0 5 0 0","onTriggerClick":"app.promptUsers('read');","editable":"false","flex":"1","triggerCls":"x-form-ellipsis-trigger","fieldLabel":"用户","labelWidth":"50"},"expanded":false,"children":[],"type":"combo"},{"configs":{"itemId":"delBtn","glyph":"f00d","buttonStyle":"default","tooltip":"重置"},"expanded":false,"children":[],"type":"button","events":{"click":"app.readUserCombo.reset();\ndelete app.perms.readUser;"}}],"type":"container"}],"type":"fieldset"},{"configs":{"itemId":"writeFs","title":"修改："},"expanded":true,"children":[{"configs":{"layout":"hbox","itemId":"roleContainer"},"expanded":true,"children":[{"configs":{"fieldCls":"wb-disabled x-form-field","itemId":"writeRoleCombo","margin":"0 5 0 0","onTriggerClick":"app.promptRoles('write');","editable":"false","flex":"1","triggerCls":"x-form-ellipsis-trigger","fieldLabel":"角色","labelWidth":"50"},"expanded":false,"children":[],"type":"combo"},{"configs":{"itemId":"delBtn","glyph":"f00d","buttonStyle":"default","tooltip":"重置"},"expanded":false,"children":[],"type":"button","events":{"click":"app.writeRoleCombo.reset();\ndelete app.perms.write;"}}],"type":"container"},{"configs":{"layout":"hbox","itemId":"userContainer"},"expanded":true,"children":[{"configs":{"fieldCls":"wb-disabled x-form-field","itemId":"writeUserCombo","margin":"0 5 0 0","onTriggerClick":"app.promptUsers('write');","editable":"false","flex":"1","triggerCls":"x-form-ellipsis-trigger","fieldLabel":"用户","labelWidth":"50"},"expanded":false,"children":[],"type":"combo"},{"configs":{"itemId":"delBtn","glyph":"f00d","buttonStyle":"default","tooltip":"重置"},"expanded":false,"children":[],"type":"button","events":{"click":"app.writeUserCombo.reset();\ndelete app.perms.writeUser;"}}],"type":"container"}],"type":"fieldset"},{"configs":{"itemId":"executeFs","title":"运行："},"expanded":true,"children":[{"configs":{"layout":"hbox","itemId":"roleContainer"},"expanded":true,"children":[{"configs":{"fieldCls":"wb-disabled x-form-field","itemId":"executeRoleCombo","margin":"0 5 0 0","onTriggerClick":"app.promptRoles('execute');","editable":"false","flex":"1","triggerCls":"x-form-ellipsis-trigger","fieldLabel":"角色","labelWidth":"50"},"expanded":false,"children":[],"type":"combo"},{"configs":{"itemId":"delBtn","glyph":"f00d","buttonStyle":"default","tooltip":"重置"},"expanded":false,"children":[],"type":"button","events":{"click":"app.executeRoleCombo.reset();\ndelete app.perms.execute;"}}],"type":"container"},{"configs":{"layout":"hbox","itemId":"userContainer"},"expanded":true,"children":[{"configs":{"fieldCls":"wb-disabled x-form-field","itemId":"executeUserCombo","margin":"0 5 0 0","onTriggerClick":"app.promptUsers('execute');","editable":"false","flex":"1","triggerCls":"x-form-ellipsis-trigger","fieldLabel":"用户","labelWidth":"50"},"expanded":false,"children":[],"type":"combo"},{"configs":{"itemId":"delBtn","glyph":"f00d","buttonStyle":"default","tooltip":"重置"},"expanded":false,"children":[],"type":"button","events":{"click":"app.executeUserCombo.reset();\ndelete app.perms.executeUser;"}}],"type":"container"}],"type":"fieldset"}],"type":"window","events":{"afterrender":"win.down('toolbar').insert(0, [{\n  text: '重置',\n  iconCls: 'undo_icon',\n  handler: function() {\n    app.perms = {};\n    Wb.reset(win);\n  }\n}, '->']);","ok":"app.doSetPerm();"}},{"configs":{"layout":"fit","border":"false","itemId":"viewport1"},"expanded":true,"children":[{"configs":{"itemId":"xwl1","file":"m?xwl=sys/tool/file"},"expanded":false,"children":[],"type":"xwl"}],"type":"viewport","events":{"afterrender":"app.xwl1.executeBtn.show();\nif (Wb.parseBool('{#showPermBtn#}'))\n  app.xwl1.permBtn.show();\napp.xwl1.editFileBtn.hide();\napp.xwl1.dblClickFileHandler = app.xwl1.execute = app.xwl1.openFile = app.execute;\napp.xwl1.setPerm = app.setPerm;"}}],"type":"module","events":{"initialize":"Wb.apply(app, {\n  /**\n   * 执行选择的资源文件。\n   */\n  execute: function() {\n    var fileExt, fileName = app.xwl1.getFileNames(false, true);\n    if (fileName.length != 1) {\n      Wb.warn('请选择1个需要运行的文件。');\n      return;\n    }\n    fileName = fileName[0];\n    fileExt = Wb.extractFileExt(fileName).toLowerCase();\n    switch (fileExt) {\n      case 'flw':\n        Flow.startFlow({\n          filename: fileName\n        });\n        break;\n      case 'qry':\n        Query.run(fileName);\n        break;\n      case 'rpt':\n        Report.run(fileName);\n        break;\n      case 'frm':\n        Form.run(fileName);\n        break;\n      default:\n        Wb.warn('该文件无法运行。');\n    }\n  },\n  /**\n   * 打开对话框，设置资源文件/目录的权限。\n   */\n  setPerm: function() {\n    var subTitle, rec, fileNames = app.xwl1.getFileNames(true, true);\n    if (!fileNames.length) {\n      Wb.warn('请选择至少1个需要设置的文件/目录。');\n      return;\n    }\n    app.fileNames = fileNames;\n    Wb.setTitle(app.permWin, Wb.getInfo(fileNames, Wb.getFilename(fileNames[0])));\n    if (fileNames.length == 1 && app.xwl1.fileGrid.getSelection()[0].data.leaf) {\n      Wb.request({\n        url: 'm?xwl=my/rm/get-perm',\n        params: {\n          fileName: fileNames[0]\n        },\n        success: function(resp) {\n          app.perms = Wb.decode(resp.responseText);\n          app.permWin.show();\n          Wb.setValue(app.permWin, app.perms);\n        }\n      });\n    } else {\n      app.perms = {};\n      app.permWin.show();\n    }\n  },\n  /**\n   * 执行设置资源文件/目录的权限。\n   */\n  doSetPerm: function() {\n    function doRequest() {\n      var permParams = Wb.getValue(app.permWin, null, null, true);\n      Wb.applyIf(permParams, app.perms);\n      permParams = Wb.clearNull(permParams);\n      Wb.request({\n        url: 'm?xwl=my/rm/set-perm',\n        params: {\n          perms: permParams,\n          fileNames: app.fileNames\n        },\n        success: function(resp) {\n          app.permWin.close();\n        }\n      });\n    }\n    if (app.fileNames.length > 1)\n      Wb.confirm('确认要设置所选的多个文件/目录及其所有子文件的权限吗？', doRequest);\n    else\n      doRequest();\n  },\n  /**\n   * 显示角色选择对话框，并把选择的角色设置到指定变量中。\n   * @param {String} type 类别。\n   */\n  promptRoles: function(type) {\n    Wb.run({\n      url: 'role-selector',\n      single: true,\n      success: function(scope) {\n        scope.show(function(roleId, roleName, win) {\n          app.perms[type] = roleId;\n          app[type + 'RoleCombo'].setValue(Wb.joinArray(roleName));\n          win.close();\n        }, {\n          roleId: app.perms[type]\n        });\n      }\n    });\n  },\n  /**\n   * 显示用户选择对话框，并把选择的用户设置到指定变量中。\n   * @param {String} type 类别。\n   */\n  promptUsers: function(type) {\n    Wb.run({\n      url: 'user-selector',\n      single: true,\n      success: function(scope) {\n        scope.show(function(userData, win) {\n          app.perms[type + 'User'] = userData.userId;\n          app[type + 'UserCombo'].setValue(Wb.joinArray(userData.displayName, userData.userName));\n          win.close();\n        }, {\n          userId: app.perms[type + 'User']\n        });\n      }\n    });\n  }\n});"}}],"roles":{"demo":1},"title":"流程监控","iconCls":"db_form_icon","inframe":false,"pageLink":""}