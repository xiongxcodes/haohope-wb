{"hidden":false,"children":[{"configs":{"itemId":"module","loginRequired":"false"},"expanded":true,"children":[{"configs":{"itemId":"window1","onEnter":"app.createBtn.fireEvent('click');","focusControl":"dbType","closable":"false","width":"600","layoutType":"anchorForm","autoShow":"true","title":"JNDI数据源创建","iconCls":"db_icon","maximizable":"false"},"expanded":true,"children":[{"configs":{"itemId":"descComp","margin":"20 0 0 20","html":"<p>提示：本模块仅支持兼容于Tomcat和部分常用数据库的JNDI数据源创建，其他Web应用服务器和数据库的JNDI创建请参考各自的配置文档。<\/p>"},"expanded":false,"children":[],"type":"comp"},{"configs":{"layout":"fit","itemId":"fieldset1","title":"JNDI 数据源创建"},"expanded":true,"children":[{"configs":{"itemId":"operCon","defaults":"{\n  labelWidth: 110\n}","layoutType":"anchorForm","autoScroll":"false"},"expanded":true,"children":[{"configs":{"allowBlank":"false","itemId":"dbType","labelAlign":"right","pickList":"[\n  ['m', 'MySQL'],\n  ['o', 'Oracle'],\n  ['s', 'SQL Server']\n]","editable":"false","fieldLabel":"数据库类型"},"expanded":false,"children":[],"type":"combo"},{"configs":{"layout":"hbox","itemId":"fieldcontainer1","allowBlank":"false","fieldLabel":"JNDI名称"},"expanded":true,"children":[{"configs":{"allowBlank":"false","itemId":"jndi","labelAlign":"right","validator":"if (app.jndi.getValue().indexOf('/') != -1)\n  return 'JNDI名称不允许包含\u201c/\u201d，有效值如：mydb';\nelse return true;","width":"100"},"expanded":false,"children":[],"type":"text","events":{"change":"app.fullJndi.setValue('java:comp/env/jdbc/' + newValue);"}},{"configs":{"itemId":"fullJndi","margin":"0 1 0 8","flex":"1","readOnly":"true"},"expanded":false,"children":[],"type":"text"}],"type":"fieldcontainer"},{"configs":{"allowBlank":"false","itemId":"ip","labelAlign":"right","fieldLabel":"数据库IP"},"expanded":false,"children":[],"type":"text"},{"configs":{"allowBlank":"false","itemId":"port","labelAlign":"right","fieldLabel":"数据库端口"},"expanded":false,"children":[],"type":"text"},{"configs":{"allowBlank":"false","itemId":"dbname","labelAlign":"right","fieldLabel":"数据库名称"},"expanded":false,"children":[],"type":"text"},{"configs":{"allowBlank":"false","itemId":"username","labelAlign":"right","fieldLabel":"数据库用户名"},"expanded":false,"children":[],"type":"text"},{"configs":{"allowBlank":"false","itemId":"password","labelAlign":"right","fieldLabel":"数据库密码"},"expanded":false,"children":[],"type":"text"},{"configs":{"layout":"hbox","itemId":"fieldcontainer2"},"expanded":true,"children":[{"configs":{"itemId":"createBtn","margin":"10","flex":"1","buttonStyle":"primary","text":"创建JNDI"},"expanded":false,"children":[],"type":"button","events":{"click":"if (!Wb.verify(app.operCon))\n  return;\n\nfunction doCreate(overwrite) {\n  Wb.request({\n    url: 'm?xwl=admin/setup/generate-jndi',\n    out: app.window1,\n    params: {\n      overwrite: overwrite\n    },\n    showError: false,\n    success: function(resp) {\n      app.jndiCreated = true;\n      Wb.info('已经创建JNDI数据源。请不要关闭本页面，并在重启Tomcat后点击[测试连接]按钮测试JNDI有效性。');\n    },\n    failure: function(resp) {\n      var msg = resp.responseText,\n        errMsg = Wb.getError(msg, 106);\n      if (errMsg) {\n        Wb.confirm(errMsg, function() {\n          doCreate(true);\n        });\n      } else\n        Wb.except(resp);\n    }\n  });\n}\ndoCreate(false);"}},{"configs":{"itemId":"testBtn","margin":"10","flex":"1","buttonStyle":"default","text":"测试连接"},"expanded":false,"children":[],"type":"button","events":{"click":"if (!app.jndiCreated) {\n  Wb.info('请先点击[创建JNDI]按钮创建JNDI，然后再测试连接。');\n  return;\n}\nWb.request({\n  url: 'm?xwl=admin/setup/test-jndi',\n  showError: false,\n  timeout: -1,\n  params: {\n    jndi: 'java:comp/env/jdbc/' + app.jndi.getValue()\n  },\n  failure: function(resp) {\n    Wb.error('连接数据库失败，请确认JNDI是否已经被创建，并在检查配置后再试一次。<br>' + Wb.encodeHtml(resp.responseText));\n  },\n  success: function() {\n    Wb.info('连接数据库成功。JNDI全名为：java:comp/env/jdbc/' + app.jndi.getValue());\n  }\n});"}}],"type":"fieldcontainer"}],"type":"container"}],"type":"fieldset"}],"type":"window"},{"configs":{"layout":"fit","itemId":"viewport1","style":"background-color:#787878;"},"expanded":true,"children":[],"type":"viewport","events":{"afterrender":"viewport.mon(viewport.el, 'keydown', function(e) {\n  if (e.getKey() == e.ENTER) {\n    app.createBtn.fireEvent('click');\n  }\n});"}}],"type":"module"}],"roles":{"default":1},"title":"创建JNDI","iconCls":"","inframe":false,"pageLink":""}