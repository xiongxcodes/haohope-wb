{"hidden":false,"children":[{"configs":{"itemId":"module"},"expanded":true,"children":[{"configs":{"itemId":"query1","sql":"select b.USER_ID,b.USER_NAME,b.DISPLAY_NAME,a.NOT_READ from\n(\n  select FROM_USER as \"USER_ID\",\n  max(IM_ID) as \"IM_ID\",\n  sum(NOT_READ) as \"NOT_READ\"\n  from WB_IM where TO_USER={?sys.user?} group by FROM_USER\n  union all\n  select TO_USER as \"USER_ID\",\n  max(IM_ID) as \"IM_ID\",\n  0 as \"NOT_READ\"\n  from WB_IM where FROM_USER={?sys.user?} group by TO_USER\n) a, WB_USER b\nwhere a.USER_ID=b.USER_ID \norder by a.IM_ID desc"},"expanded":false,"children":[],"type":"query"},{"configs":{"itemId":"serverscript1","script":"var users = {},\n  i = 0,\n  rec,\n  rs = app.get('query1'),\n  meta = rs.getMetaData(),\n  rows = [];\n\n//去除重复的USER_ID并取前1000条记录返回\nwhile (rs.next()) {\n  rec = Wb.getRecord(rs, meta);\n  if (users[rec.USER_ID])\n    continue;\n  users[rec.USER_ID] = true;\n  rows.push(rec);\n  i++;\n  if (i > 1000)\n    break;\n}\napp.send({\n  metaData: {\n    fields: ['USER_ID', 'USER_NAME', 'DISPLAY_NAME', 'NOT_READ']\n  },\n  rows: rows\n});"},"expanded":false,"children":[],"type":"serverscript"}],"type":"module"}],"roles":{},"title":"查询历史用户","iconCls":"","inframe":false,"pageLink":""}