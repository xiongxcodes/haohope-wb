{"hidden":false,"children":[{"configs":{"itemId":"module"},"expanded":true,"children":[{"configs":{"itemId":"menu","menu":" [{\n   text: '添加',\n   glyph: 'f067',\n   handler: app.add\n }, {\n   text: '修改',\n   glyph: 'f044',\n   handler: app.edit\n }, {\n   text: '删除',\n   glyph: 'f00d',\n   handler: app.remove\n }, {\n   text: '刷新',\n   glyph: 'f021',\n   handler: app.refresh\n }]"},"expanded":false,"children":[],"type":"tpanel"},{"configs":{"layout":"card","itemId":"viewport1"},"expanded":true,"children":[{"configs":{"layout":"fit","itemId":"container1"},"expanded":true,"children":[{"configs":{"itemId":"toolbar","title":"员工管理","docked":"top"},"expanded":true,"children":[{"configs":{"itemId":"menuBtn","glyph":"f0c9","align":"right"},"expanded":false,"children":[],"type":"tbutton","events":{"tap":"app.menu.showBy(button);"}}],"type":"ttitlebar"},{"configs":{"itemId":"list1","autoPaging":"true","itemTpl":"{REAL_NAME} ({EMPLOYEE_CODE})"},"expanded":true,"children":[{"configs":{"itemId":"store","autoLoad":"true","url":"m?xwl=apps/sys/demo/crud/basic/select"},"expanded":false,"children":[],"type":"tstore"}],"type":"tlist","events":{"itemdoubletap":"app.edit();"}}],"type":"tcontainer"},{"configs":{"itemId":"editPanel","scrollable":"true"},"expanded":true,"children":[{"configs":{"itemId":"editTitleBar","docked":"top"},"expanded":true,"children":[{"configs":{"itemId":"cancelBtn","text":"取消","align":"left"},"expanded":false,"children":[],"type":"tbutton","events":{"tap":"app.viewport1.setActiveItem(app.container1);"}},{"configs":{"itemId":"okBtn","text":"确定","align":"right"},"expanded":false,"children":[],"type":"tbutton","events":{"tap":"if (!Wb.verify(app.editPanel))\n  return;\nvar values = Wb.getValue(app.editPanel);\nif (app.isEdit) {\n  //点击修改按钮的处理过程\n  Wb.request({\n    url: 'm?xwl=examples/templates/employee/dialog/update',\n    params: Wb.applyIf(values, Wb.getData(app.selRec, true)), //合并窗口和记录数据作为参数，后者为默认值\n    success: function() {\n      //把窗口数据更新到选择记录中\n      Wb.update(app.selRec, values);\n      //返回到数据列表\n      app.viewport1.setActiveItem(app.container1);\n    }\n  });\n} else {\n  //点击添加按钮的处理过程\n  Wb.request({\n    url: 'm?xwl=examples/templates/employee/dialog/insert',\n    params: values,\n    success: function(resp) {\n      //把服务器返回的数据合并窗口数据（公司名称等数据）添加到list中\n      var recs = Wb.add(app.list1, Wb.apply(Wb.decode(resp.responseText), values), 'first');\n      //返回到数据列表\n      app.viewport1.setActiveItem(app.container1);\n      //滚动到新添加的记录位置\n      app.list1.scrollToRecord(recs[0]);\n    }\n  });\n}"}}],"type":"ttitlebar"},{"configs":{"itemId":"fieldset1"},"expanded":true,"children":[{"configs":{"tagConfigs":"{\n  remark: '该控件可以使用tnlist树形控件替代，在新card中以树形显示部门结构'\n}","itemId":"DEPT_ID","displayField":"DEPT_NAME","label":"部门","valueField":"DEPT_ID","required":"true"},"expanded":true,"children":[{"configs":{"itemId":"store","normalName":"companyStore","autoLoad":"true","url":"m?xwl=apps/sys/demo/crud/basic/select-dept"},"expanded":false,"children":[],"type":"tstore"}],"type":"tselect"},{"configs":{"itemId":"EMPLOYEE_CODE","label":"员工编号","required":"true"},"expanded":false,"children":[],"type":"ttext"},{"configs":{"itemId":"REAL_NAME","label":"姓名","required":"true"},"expanded":false,"children":[],"type":"ttext"},{"configs":{"itemId":"BIRTH_DATE","label":"出生日期","required":"true"},"expanded":false,"children":[],"type":"tdate"},{"configs":{"itemId":"SEX","keyName":"sex","label":"性别","required":"true"},"expanded":false,"children":[],"type":"tselect"},{"configs":{"itemId":"NATION","keyName":"nation","label":"民族"},"expanded":false,"children":[],"type":"tselect"},{"configs":{"itemId":"EMAIL","xtype":"emailfield","label":"电子邮件"},"expanded":false,"children":[],"type":"ttext"},{"configs":{"itemId":"COMPANY_NAME","label":"负责公司"},"expanded":false,"children":[],"type":"ttext","events":{"focus":"//基于良好的用户体验，可以使用HTML5定制公司选择器（可以参照大部分app的地名选择设计），此例作为演示使用list控件替代。\ntext.blur();\napp.viewport1.setActiveItem(app.companySelector);"}},{"configs":{"itemId":"VACATION_HOURS","minValue":"0","label":"休假时长","decimalPrecision":"0"},"expanded":false,"children":[],"type":"tnumber"},{"configs":{"itemId":"COMPANY_ID"},"expanded":false,"children":[],"type":"thidden"},{"configs":{"itemId":"REMARK","xtype":"textareafield","label":"备注"},"expanded":false,"children":[],"type":"ttext"}],"type":"tfieldset"}],"type":"tcontainer","events":{"action":"app.okBtn.fireEvent('tap');"}},{"configs":{"layout":"fit","itemId":"companySelector"},"expanded":true,"children":[{"configs":{"layout":"hbox","itemId":"toolbar1","docked":"top"},"expanded":true,"children":[{"configs":{"itemId":"backBtn","glyph":"f053","align":"left"},"expanded":false,"children":[],"type":"tbutton","events":{"tap":"app.viewport1.setActiveItem(app.editPanel);"}},{"configs":{"itemId":"searchCompanyText","flex":"1","placeHolder":"公司名称"},"expanded":false,"children":[],"type":"ttext","events":{"keyup":"//paste亦触发该事件\napp.searchCompany();"}},{"configs":{"itemId":"searchBtn","glyph":"f002","align":"right"},"expanded":false,"children":[],"type":"tbutton","events":{"tap":"app.searchCompany();"}}],"type":"ttoolbar"},{"configs":{"itemId":"companyList","itemTpl":"{COMPANY_NAME}"},"expanded":true,"children":[{"configs":{"itemId":"store","normalName":"companyStore","autoLoad":"true","url":"m?xwl=examples/templates/employee/edit/company-list"},"expanded":false,"children":[],"type":"tstore"}],"type":"tlist","events":{"select":"Wb.setValue(app.editPanel, record.data);\napp.viewport1.setActiveItem(app.editPanel);\nevent.preventDefault();"}}],"type":"tcontainer"}],"type":"tviewport"}],"type":"module","events":{"initialize":"Wb.apply(app, {\n  add: function() {\n    app.editTitleBar.setTitle('添加');\n    app.viewport1.setActiveItem(app.editPanel);\n    Wb.reset(app.editPanel);\n    Wb.resetScroll(app.editPanel);\n    app.isEdit = false;\n  },\n  edit: function() {\n    var r = app.list1.getSelection()[0];\n    if (!r) {\n      Wb.warn('请选择1条记录。');\n      return;\n    }\n    app.selRec = r;\n    app.editTitleBar.setTitle('修改 - ' + r.data.REAL_NAME);\n    app.viewport1.setActiveItem(app.editPanel);\n    Wb.setValue(app.editPanel, r.data);\n    app.isEdit = true;\n  },\n  remove: function() {\n    var sels = app.list1.getSelection();\n    Wb.confirmDo(sels, function() {\n      Wb.request({\n        url: 'm?xwl=examples/templates/employee/dialog/delete',\n        params: {\n          destroy: Wb.getData(sels, true)\n        },\n        success: function() {\n          Wb.remove(app.list1, sels);\n        }\n      });\n    }, 'REAL_NAME');\n  },\n  refresh: function() {\n    app.store.load(); //不可使用app.store.reload，因为最后一次加载属于添加模式\n  },\n  searchCompany: function() {\n    app.companyStore.load({\n      params: {\n        query: app.searchCompanyText.getValue()\n      }\n    });\n  }\n});"}}],"roles":{},"title":"CRUD基本操作","iconCls":"","inframe":true,"pageLink":""}