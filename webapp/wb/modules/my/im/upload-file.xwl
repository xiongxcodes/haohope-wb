{"hidden":false,"children":[{"configs":{"itemId":"module","serverScript":"var fileHtml, id = app.get('sys.id'),\n  fileName = app.get('file1__name'),\n  fileExt = FileUtil.getFileExt(fileName).toLowerCase();\nswitch (fileExt) {\n  case 'png':\n  case 'jpg':\n  case 'gif':\n  case 'bmp':\n    //把上传的文件流转换为基于内存的字节流以使流重复读取\n    var img, width, height, maxSize, rate, bs = SysUtil.toByteArrayInputStream(app.get('file1'));\n    try {\n      img = javax.imageio.ImageIO.read(bs);\n      width = img.getWidth();\n      height = img.getHeight();\n    } catch (e) {\n      width = 200;\n      height = 150;\n    }\n    maxSize = Math.max(width, height);\n    //象素大于600，同比缩放至最大600\n    if (maxSize > 600) {\n      rate = maxSize / 600;\n      width = Math.round(width / rate);\n      height = Math.round(width / rate);\n    }\n    //在img中添加width和height可使页面滚动条位置精确\n    fileHtml = Wb.format('<img title=\"%s\" width=\"%spx\" height=\"%spx\" src=\"m?xwl=my/im/get-blob&type=image&id=%s\"/>', fileName, width, height, id);\n    bs.reset();\n    app.set('file1', bs);\n    break;\n  default:\n    fileHtml = '<a href=\"javascript:Wb.download(\\'m?xwl=my/im/get-blob&type=blob&id=' + id + '\\')\">' + StringUtil.toHTML(fileName) + '<\/a>';\n}\napp.set('fileHtml', fileHtml);\napp.run('insert into WB_IM values ({?sys.id?},{?sys.date?},{?sys.user?},{?TO_USER?},1,{?file1__name?},{?numeric.file1__size?},{?clob.fileHtml?},{?blob.file1?})');\napp.send({\n  date: app.get('sys.date'),\n  html: fileHtml,\n  id: id\n});"},"expanded":false,"children":[],"type":"module"}],"roles":{},"title":"上传文件","iconCls":"","inframe":false,"pageLink":""}