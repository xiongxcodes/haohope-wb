{"hidden":true,"children":[{"configs":{"itemId":"module","internalCall":"true"},"expanded":true,"children":[{"configs":{"itemId":"postTpl","html":"<table class=\"bbs-post-table\" postId=\"%s\">\n  <tr class=\"bbs-post-header\"><td width=\"200px\">%s<\/td><td align=\"right\">%s<\/td><\/tr>\n  <tr>\n    <td class=\"bbs-post-info\">\n      <table>\n        <tr><td colspan=\"2\" class=\"bb-post-user\"><b>%s<\/b><\/td><\/tr>\n        <tr><td class=\"wb_nowrap\">用户名称：<\/td><td>%s<\/td><\/tr>\n        <tr><td class=\"wb_nowrap\">加入日期：<\/td><td>%s<\/td><\/tr>\n        <tr><td class=\"wb_nowrap\">登录次数：<\/td><td>%s<\/td><\/tr>\n      <\/table>\n    <\/td>\n    <td class=\"bbs-post-detail\">%s<\/td>\n  <\/tr>\n<\/table>\n"},"expanded":false,"children":[],"type":"string"},{"configs":{"itemId":"serverscript1","script":"var editBtn,\n  deleteBtn,\n  dateFormat = new java.text.SimpleDateFormat('yyyy-MM-dd HH:mm'),\n  postTpl = app.get('postTpl');\n\nif (app.perm('m?xwl=dev/otherinfo/community/update-post'))\n  editBtn = '<span class=\"wb_gbutton\" xitemId=\"editPost\" title=\"编辑该回复\">&#xf044<\/span>&nbsp;';\nelse\n  editBtn = '';\nif (app.perm('m?xwl=dev/otherinfo/community/delete-post'))\n  deleteBtn = '<span class=\"wb_gbutton\" xitemId=\"deletePost\" title=\"删除该回复\">&#xf00d<\/span>&nbsp;';\nelse\n  deleteBtn = '';\nWb.apply(app, {\n  /**\n   * 获得回复帖子的HTML片断。\n   * @param {String} postId 回复的id号。如果是主题标题可以设置为空串。\n   * @param {JavaDate} postDate 日期。\n   * @param {String} header 标题右侧文本。\n   * @param {String} displayName 显示用户名称。\n   * @param {String} userName 用户名称。\n   * @param {JavaDate} userCreateDate 用户创建日期。\n   * @param {Number} loginTimes 登录次数。\n   * @param {String} content 回复的内容。\n   * @param {Boolean} showButton 是否显示功能按钮。\n   * @return {String} HTML脚本。\n   */\n  getPostHtml: function(postId, postDate, header, displayName, userName, userCreateDate, loginTimes, content, showButton) {\n    return Wb.format(postTpl, postId, dateFormat.format(postDate), (showButton ? editBtn : '') + (showButton ? deleteBtn : '') + header,\n      displayName, userName, dateFormat.format(userCreateDate), Integer.toString(loginTimes), content);\n  },\n  /**\n   * 获取回复主题列表HTML。\n   * @param {Boolean} browseMode 是否为浏览模式。\n   * @return {String} HTML脚本。\n   */\n  getPostListHtml: function(browseMode) {\n    var html, rs, title, createDate, postId, postDate, userName, displayName,\n      userCreateDate, loginTimes, content, index = 1;\n\n    rs = app.run('select a.TITLE,a.CREATE_DATE,b.USER_NAME,b.DISPLAY_NAME,b.CREATE_DATE as \"USER_CREATE_DATE\",b.LOGIN_TIMES,a.CONTENT from WB_BBS_TITLE a, WB_USER b where a.CREATE_USER=b.USER_ID and a.TITLE_ID={?id?}');\n    rs.next();\n    title = StringUtil.toHTML(rs.getString('TITLE'));\n    createDate = rs.getTimestamp('CREATE_DATE');\n    userName = rs.getString('USER_NAME');\n    displayName = rs.getString('DISPLAY_NAME');\n    userCreateDate = rs.getTimestamp('USER_CREATE_DATE');\n    loginTimes = rs.getInt('LOGIN_TIMES');\n    content = DbUtil.getText(rs, 'CONTENT') || '';\n    html = '<div class=\"bbs-center-div\">';\n    html += app.getPostHtml('', createDate, '题主', displayName, userName, userCreateDate, loginTimes,\n      '<p style=\"border-bottom:1px solid #D7D7D7;padding-bottom:10px;\">' + title + '<\/p>' + content);\n    rs = app.run('select a.POST_ID,a.POST_DATE,b.USER_NAME,b.DISPLAY_NAME,b.CREATE_DATE as \"USER_CREATE_DATE\",b.LOGIN_TIMES,a.CONTENT from WB_BBS_POST a, WB_USER b where a.POST_USER=b.USER_ID and a.TITLE_ID={?id?} order by a.POST_DATE');\n    while (rs.next()) {\n      postId = rs.getString('POST_ID');\n      postDate = rs.getTimestamp('POST_DATE');\n      userName = rs.getString('USER_NAME');\n      displayName = rs.getString('DISPLAY_NAME');\n      userCreateDate = rs.getTimestamp('USER_CREATE_DATE');\n      loginTimes = rs.getInt('LOGIN_TIMES');\n      content = DbUtil.getText(rs, 'CONTENT') || '';\n      html += app.getPostHtml(postId, postDate, '#' + Integer.toString(index++), displayName, userName, userCreateDate, loginTimes, content, !browseMode);\n    }\n    if (browseMode)\n      html += '<p><a href=\"title-list\" style=\"margin-left:20px\">返回<\/a><a href=\"http://www.geejing.com/community\" target=\"_blank\" style=\"margin-left:20px\">开发者社区<\/a><\/p>';\n    html += '<\/div>';\n    app.set({\n      html: html\n    });\n    //主题查看数量+1\n    app.run('update WB_BBS_TITLE set VIEW_COUNT=VIEW_COUNT+1 where TITLE_ID={?id?}');\n    return {\n      html: html,\n      title: title\n    };\n  }\n});"},"expanded":false,"children":[],"type":"serverscript"}],"type":"module"}],"roles":{"demo":1},"title":"公共方法","iconCls":"","inframe":false,"pageLink":""}