{"hidden":true,"children":[{"configs":{"itemId":"module","loginRequired":"false"},"expanded":true,"children":[{"configs":{"itemId":"main","padding":"10 30 10 0","flat":"true","width":"376","layoutType":"anchorForm","autoScroll":"false"},"expanded":true,"children":[{"configs":{"allowBlank":"false","itemId":"username","fieldLabel":"@Str.username","fieldStyle":"padding-left:28px;background-image:url(wb/images/app/user.png);background-repeat:no-repeat;background-position:left center;"},"expanded":false,"children":[],"type":"text"},{"configs":{"allowBlank":"false","itemId":"password","fieldLabel":"@Str.password","inputType":"password","fieldStyle":"padding-left:28px;background-image:url(wb/images/app/password.png);background-repeat:no-repeat;background-position:left center;"},"expanded":false,"children":[],"type":"text"},{"configs":{"layout":"hbox","itemId":"verifyContainer","allowBlank":"false","fieldLabel":"@Str.verifyCode"},"expanded":true,"children":[{"configs":{"allowBlank":"true","itemId":"verifyCode","flex":"1","fieldStyle":"padding-left:28px;background-image:url(wb/images/app/check.png);background-repeat:no-repeat;background-position:left center;"},"expanded":true,"children":[],"type":"text"},{"configs":{"itemId":"verifyImage","margin":"0 0 0 5","alt":"@Str.verifyCode","width":"90","style":"cursor:pointer;","title":"@Str.clickChangeVC","height":"Wb.getDefaultHeight()"},"expanded":false,"children":[],"type":"image","events":{"click":"app.changeVC();\napp.verifyCode.focus(true, true);"}}],"type":"fieldcontainer"},{"configs":{"itemId":"saveNameCheck","boxLabel":"@Str.saveUserName","hideEmptyLabel":"false"},"expanded":false,"children":[],"type":"check","events":{"change":"if (!newValue)\n  Ext.util.Cookies.clear('sys.username');"}}],"type":"panel","events":{"beforerender":"app.verifyEnabled = Wb.parseBool('{#Var.sys.session.verifyImage.enabled#}');\nif (app.verifyEnabled)\n  app.verifyImage.src = 'm?xwl=sys/session/get-verify-image';\nelse\n  app.verifyContainer.hidden = true;","afterrender":"var username = Wb.getCookie('sys.username');\nWb.monEnter(panel, function() {\n  app.login();\n});\napp.saveNameCheck.setValue(!!username);\nif (Wb.isEmpty(username)) {\n  //单独timeout防止focus任务被cancel\n  setTimeout(function() {\n    app.username.focus();\n  }, 50);\n} else {\n  app.username.setValue(username);\n  setTimeout(function() {\n    app.password.focus();\n  }, 50);\n}"}}],"type":"module","events":{"initialize":"Wb.apply(app, {\n  changeVC: function() {\n    app.verifyImage.setSrc('m?xwl=sys/session/get-verify-image&' + Wb.getId());\n  },\n  /**\n   * 登录成功后的回调函数。可通过重载该方法来实现执行不同的回调功能。\n   * @param {Object} resp 包含响应数据的XMLHttpRequest对象。\n   */\n  loginSuccess: function(resp) {\n    var obj = Wb.decode(resp.responseText);\n    if (app.saveNameCheck.getValue())\n      Wb.setCookie('sys.username', app.username.getValue());\n    window.location = app.main.referUrl || obj.referer;\n  },\n  /**\n   * 发起请求以登录到系统。\n   */\n  login: function() {\n    if (!Wb.verify(app.main))\n      return;\n    Wb.request({\n      url: 'verify-user',\n      out: app.main,\n      message: Str.processLogin,\n      showError: false,\n      success: function(resp) {\n        Wb.broadcast('xSessionReconnect');\n        app.loginSuccess(resp);\n      },\n      failure: function(resp) {\n        if (app.verifyEnabled)\n          app.changeVC();\n        Wb.except(resp, function() {\n          var s = resp.responseText;\n          switch (s) {\n            case Str.vcInvalid:\n            case Str.vcExpired:\n              if (!app.verifyCode.hidden)\n                app.verifyCode.focus(true, true);\n              break;\n            case Str.passwordInvalid:\n              app.password.focus(true, true);\n              break;\n            default:\n              app.username.focus(true, true);\n              break;\n          }\n        });\n      }\n    });\n  },\n  /**\n   * 重置登录界面中控件的数据。\n   */\n  reset: function() {\n    Wb.reset(app.main);\n  },\n  /**\n   * 显示用户帐户注册对话框。\n   */\n  register: function() {\n    Wb.run({\n      url: 'register-account',\n      single: true,\n      success: function(scope) {\n        scope.show(function(userData, win) {\n          app.username.setValue(userData.USER_NAME);\n          win.close();\n          app.password.focus(true, true);\n        });\n      }\n    });\n  }\n});"}}],"roles":{"default":1},"title":"登录对话框","iconCls":"","inframe":false,"pageLink":""}